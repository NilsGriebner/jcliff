#    Copyright 2013 Red Hat, Inc. and/or its affiliates.
#
#    This file is part of jcliff.
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

name=web
getContents=/subsystem=web:read-resource(recursive=true)
server.preprocess.prepend=/web

match.modifyprop=modify:/web/configuration/*/*
modifyprop.rule.1=/subsystem=web/configuration=${name(..)}:write-attribute(name=${name(.)},value=${value(.)})

match.addConfiguration=add:/web/configuration/*
addConfiguration.rule=/subsystem=web/configuration=${name(.)}:add
addConfiguration.refresh=true

# Connectors
match.addConnector=add:/web/connector/*
addConnector.rule=/subsystem=web/connector=${name(.)}:add(protocol=${value(protocol)},scheme=${value(scheme)},socket-binding=${value(socket-binding)})
addConnector.refresh=true
addConnector.precedence=40

match.modifyConnectorAttribute=modify:/web/connector/*/*
modifyConnectorAttribute.rule=/subsystem=web/connector=${name(..)}:write-attribute(name=${name(.)},value=${value(.)})

match.removeConnector=remove:/web/connector/*
removeConnector.rule=/subsystem=web/connector=${name(.)}:remove
removeConnector.refresh=true

match.undefineConnectorAttribute=undefine:/web/connector/*/*
undefineConnectorAttribute.rule=/subsystem=web/connector=${name(..)}:undefine-attribute(name=${name(.)})

# virtual-servers
match.addVirtualServer=add:/web/virtual-server/*
addVirtualServer.rule=/subsystem=web/virtual-server=${name(.)}:add(alias=${value(alias)},default-web-module=${value(default-web-module)},enable-welcome-root=${value(enable-welcome-root)})
addVirtualServer.refresh=true
addVirtualServer.precedence=50

match.modifyVirtualServer=modify:/web/virtual-server/*/*
modifyVirtualServer.rule=/subsystem=web/virtual-server=${name(..)}:write-attribute(name=${name(.)},value=${value(.)})
modifyVirtualServer.precedence=60

match.removeVirtualServer=remove:/web/virtual-server/*
removeVirtualServer.rule=/subsystem=web/virtual-server=${name(.)}:remove
removeVirtualServer.refresh=true

#access-log
match.addAccessLog=add:/web/virtual-server/*/configuration/*
addAccessLog.rule=/subsystem=web/virtual-server=${name(../..)}/access-log=configuration:add(pattern=${value(pattern)})
addAccessLog.precedence=60
addAccessLog.refresh=true

match.modifyAccessLog=modify:/web/virtual-server/*/configuration/access-log/*
modifyAccessLog.rule=/subsystem=web/virtual-server=${name(../../..)}/access-log=configuration:write-attribute(name=${name(.)},value=${value(.)})
modifyAccessLog.precedence=70

match.removeAccessLog=remove:/web/virtual-server/*/configuration/access-log/*
removeAccessLog.rule=subsystem=web/virtual-server=${name(../..)}/access-log=configuration:remove
removeAccessLog.precedence=60

#SSL
match.addSSL=add:/web/connector/HTTPS/configuration/ssl/*
addSSL.rule=/subsystem=web/connector=HTTPS/ssl=configuration:add(certificate-key-file=${value(../certificate-key-file)},password=${value(../password)},key-alias=${value(../key-alias)})
addSSL.refresh=true
addSSL.precedence=60
 
match.modifySSL=modify:/web/connector/HTTPS/configuration/ssl/*
modifySSL.rule=/subsystem=web/connector=HTTPS/ssl=configuration:write-attribute(name=${name(.)},value=${value(.)})

# root level attributes
match.addRootAttribute=add:/web/*
addRootAttribute.rule=/subsystem=web:write-attribute(name=${name(.)},value=${value(.)})

match.modifyRootAttribute=modify:/web/*
modifyRootAttribute.rule=/subsystem=web:write-attribute(name=${name(.)},value=${value(.)})

match.undefineRootAttribute=undefine:/web/*
undefineRootAttribute.rule=/subsystem=web:undefine-attribute(name=${name(.)})
